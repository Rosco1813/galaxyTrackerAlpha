[gd_scene load_steps=3 format=3 uid="uid://c67pg65lyu5jv"]

[ext_resource type="Script" path="res://globals/interaction_prompt.gd" id="1_prompt"]

[sub_resource type="GDScript" id="GDScript_icon"]
script/source = "extends Control

const ICON_SIZE := 32.0
const MENU_HIGHLIGHT_COLOR := Color(0.95, 0.85, 0.2, 1.0)

func _ready() -> void:
	custom_minimum_size = Vector2(ICON_SIZE * 1.8, ICON_SIZE)

func _draw() -> void:
	var center := Vector2(size.x / 2, size.y / 2)
	var radius := ICON_SIZE / 2 - 2
	var controller_type := InputManager.get_controller_type()
	
	match controller_type:
		InputManager.ControllerType.PLAYSTATION:
			_draw_playstation_cross(center, radius)
		InputManager.ControllerType.XBOX:
			_draw_xbox_a(center, radius)
		InputManager.ControllerType.GENERIC:
			_draw_generic_button(center, radius)
		_:  # KEYBOARD
			_draw_keyboard_space(center)

func _draw_playstation_cross(center: Vector2, radius: float) -> void:
	# Circle outline
	draw_arc(center, radius, 0, TAU, 32, MENU_HIGHLIGHT_COLOR, 2.0)
	# Cross (X) shape
	var cross_size := radius * 0.5
	var thickness := 3.0
	draw_line(center + Vector2(-cross_size, -cross_size), center + Vector2(cross_size, cross_size), MENU_HIGHLIGHT_COLOR, thickness)
	draw_line(center + Vector2(cross_size, -cross_size), center + Vector2(-cross_size, cross_size), MENU_HIGHLIGHT_COLOR, thickness)

func _draw_xbox_a(center: Vector2, radius: float) -> void:
	# Circle outline
	draw_arc(center, radius, 0, TAU, 32, MENU_HIGHLIGHT_COLOR, 2.0)
	# Letter A - centered in circle
	var font := ThemeDB.fallback_font
	var font_size := int(radius * 1.2)
	var text_size := font.get_string_size(\"A\", HORIZONTAL_ALIGNMENT_LEFT, -1, font_size)
	var text_pos := Vector2(center.x - text_size.x / 2, center.y + text_size.y / 4)
	draw_string(font, text_pos, \"A\", HORIZONTAL_ALIGNMENT_LEFT, -1, font_size, MENU_HIGHLIGHT_COLOR)

func _draw_generic_button(center: Vector2, radius: float) -> void:
	# Circle with \"1\" - centered
	draw_arc(center, radius, 0, TAU, 32, MENU_HIGHLIGHT_COLOR, 2.0)
	var font := ThemeDB.fallback_font
	var font_size := int(radius * 1.2)
	var text_size := font.get_string_size(\"1\", HORIZONTAL_ALIGNMENT_LEFT, -1, font_size)
	var text_pos := Vector2(center.x - text_size.x / 2, center.y + text_size.y / 4)
	draw_string(font, text_pos, \"1\", HORIZONTAL_ALIGNMENT_LEFT, -1, font_size, MENU_HIGHLIGHT_COLOR)

func _draw_keyboard_space(center: Vector2) -> void:
	# Rounded rectangle for keyboard key
	var rect_size := Vector2(ICON_SIZE * 1.6, ICON_SIZE * 0.8)
	var rect := Rect2(center - rect_size / 2, rect_size)
	
	# Draw rounded rect outline
	var points := PackedVector2Array()
	var corner := 4.0
	points.append(Vector2(rect.position.x + corner, rect.position.y))
	points.append(Vector2(rect.end.x - corner, rect.position.y))
	points.append(Vector2(rect.end.x, rect.position.y + corner))
	points.append(Vector2(rect.end.x, rect.end.y - corner))
	points.append(Vector2(rect.end.x - corner, rect.end.y))
	points.append(Vector2(rect.position.x + corner, rect.end.y))
	points.append(Vector2(rect.position.x, rect.end.y - corner))
	points.append(Vector2(rect.position.x, rect.position.y + corner))
	points.append(Vector2(rect.position.x + corner, rect.position.y))
	
	draw_polyline(points, MENU_HIGHLIGHT_COLOR, 2.0)
	
	# Text \"Space\"
	var font := ThemeDB.fallback_font
	var font_size := 12
	var text_size := font.get_string_size(\"Space\", HORIZONTAL_ALIGNMENT_CENTER, -1, font_size)
	var text_pos := center - text_size / 2 + Vector2(0, text_size.y * 0.35)
	draw_string(font, text_pos, \"Space\", HORIZONTAL_ALIGNMENT_CENTER, -1, font_size, MENU_HIGHLIGHT_COLOR)
"

[node name="InteractionPrompt" type="CanvasLayer"]
layer = 100
process_mode = 3
script = ExtResource("1_prompt")

[node name="Control" type="Control" parent="."]
layout_mode = 3
anchors_preset = 12
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
offset_top = -100.0
grow_horizontal = 2
grow_vertical = 0

[node name="PanelContainer" type="PanelContainer" parent="Control"]
layout_mode = 1
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -100.0
offset_top = -60.0
offset_right = 100.0
grow_horizontal = 2
grow_vertical = 0

[node name="MarginContainer" type="MarginContainer" parent="Control/PanelContainer"]
layout_mode = 2
theme_override_constants/margin_left = 16
theme_override_constants/margin_top = 8
theme_override_constants/margin_right = 16
theme_override_constants/margin_bottom = 8

[node name="HBoxContainer" type="HBoxContainer" parent="Control/PanelContainer/MarginContainer"]
layout_mode = 2
theme_override_constants/separation = 12

[node name="ButtonIcon" type="Control" parent="Control/PanelContainer/MarginContainer/HBoxContainer"]
custom_minimum_size = Vector2(60, 32)
layout_mode = 2
script = SubResource("GDScript_icon")

[node name="ActionLabel" type="Label" parent="Control/PanelContainer/MarginContainer/HBoxContainer"]
layout_mode = 2
theme_override_colors/font_color = Color(0.95, 0.85, 0.2, 1)
theme_override_font_sizes/font_size = 18
text = "to Enter"
